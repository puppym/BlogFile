# 以太坊上的进展

本文主要简洁的记录了以太坊上的一些进展。主要摘取了[link](https://mp.weixin.qq.com/s/aVOJNdkgi9dCQQqCvCctRQ)中的一些内容。

## 以太坊1.x

**基本上，以太坊 1.x 是希望解决以太坊 PoW 链面临的一些根本性问题**。其中一个就是众所周知的 “状态爆炸问题”。

在以太坊协议的运行中，哪个账户有多少钱、合约里面存储的数据，都会不断更新，也会不断有新合约产生。这些内容（账户余额、合约代码、合约存储内容）我们称为“状态”，它们是以太坊区块链处理一些区块后的结果，表示处理完区块后该时刻的以太坊网络全局状态，也必然随新区块的产生而不断更新。为实现快速的区块验证（也是区块执行，因为验证的方式就是把所有交易重新执行一遍），节点本地会把关于状态的数据（简称“状态数据”）专门保存起来，并随着区块的产生而不断更新。那么，从理论上来说，这部分数据的体量会随着账户数量的增加而不断上升，而且，每次访问的状态及输出的状态的存储位置都是不确定的。

状态数据爆发式增长会带来两个问题：1）因为访问及输出的状态的存储位置不确定，就会使运行以太坊客户端的节点产生大量的硬盘随机读写需求（这就是为什么需要用固态硬盘来运行以太坊客户端），而且这部分需求会越来越高，不断提高参与验证以太坊网络的硬件成本，造成网络节点数量的减少及集中化；2）使得新节点加入网络变得越来越难，因为新节点在刚加入网络时需要向其它节点请求的状态数据会变得越来越多。

而**以太坊 1.x 的解决思路就是 “无状态以太坊”**，让验证交易所需的状态证明（叫做 “witness”）随区块一起传播。收到交易及 witness 的节点可以通过本地储存的状态根（以太坊状态是用默克尔-帕特里夏树来表达的，所谓状态根就是默克尔树的根值，是一个哈希值）来校验 witness 的有效性，并进一步检验交易的有效性。如此一来，节点就不用在本地大量访问状态数据并写入状态数据（这就是为什么它叫做 “无状态”）。

无状态模式有很多好处，首先是因为交易本身整合了验证交易所需的数据，验证交易会变得更快，能提高节点的处理速度；其次，无状态模式下，数据本身被拆解了，那么一些客户端就可以根据自己的数据需求做定向的优化，比如可以有仅提供 DeFi 应用的交易及 witness 的节点。

虽然听起来有这么多好处，在实践中它会遭遇很大的一个问题，就是它需要额外的带宽。在当前的实际运行中，以太坊区块的平均数据量大小是 20 多 KB。但是，目前的研究表明，即使我们对以太坊状态树的实现作一些改进，无状态客户端所需的 witness 大小仍然在 0.5MB 左右。对当前的以太坊网络来说，负担太大了。见证数据大小是无状态模式要克服的首要调整，如果大小降不下来，就几乎不可能实行。

不过，好消息是，无状态以太坊的研究（算是）已经产生出了一个成果，就是 Beam 同步方式。Beam 借鉴了 Fast 同步方法和无状态模式的优点，下载到最新区块之后便开始一边请求验证交易所需的状态数据，一边在本地尝试恢复完整的状态。这种方法对硬件有一定要求，而且当前实现的效果还不稳定。但是运行良好的情况下，能在下载完区块头数据后几分钟内转入完全验证模式，也是一大突破。

无状态以太坊的思虑是很深远的，要解决的问题也是根本性的，涉及到 PoW 链的长期稳定性。即使它当前不可行，这一方向的研究也会为以太坊协议的改进提供许多灵感。

参考文献：

- [以太坊无状态客户端初探](http://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652527694&idx=1&sn=e8a61777d8ec17c6a0445da337d7004c&chksm=8ce65f13bb91d605adf4833cdf870ac13d24b0f46885c9509159adbc814d0d6e785aa27a008f&scene=21#wechat_redirect)
- [无状态以太坊：二进制状态树实验](http://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652528980&idx=1&sn=7de5cc9c5093dbd5f40d6a17495ad546&chksm=8ce66209bb91eb1f1ab362f26b8f844d3ce5e958a6dd09f1faa9f42d85c75437c559e72d5515&scene=21#wechat_redirect)
- [Beam Sync：同步以太坊节点的新方法](http://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652529229&idx=1&sn=ed185a780c71dc7029cf807dc538bf81&chksm=8ce66110bb91e806d909694b40552e072fa067a1cc3f541d5404972e13d4e87d64746494d579&scene=21#wechat_redirect)

## Layer-2 扩容方案

Layer-2 的概念本身只提到了计算（执行）应该在链下进行，但没有提到 Layer-2 交易的原始数据应该放在哪里，用户应当如何维护并获取自己账户的最新状态；这也正是 Layer-2 方案的设计空间。此前的方案为了减轻 Layer-1 的存储负担，在链上是不存储 Layer-2 交易数据的，有些只定期在链上存储 Layer-2 状态的状态根（如某些 Plasma 方案），有些是什么都不存（如大部分状态通道方案）。

但是问题来了。当用户的资金从 Layer-2 退出到 Layer-1 的时候，可能会发生争议，比如我觉得我的账户里应该还有 10 块钱，但怎么取款只取出了 5 块，那我要怎么证明我的账户里实际上有 10 块钱呢。要求用户来保存相关的数据并在此时提交，首先用户体验就很差，其次还未必能获得良好的证明效果。

于是有开发者在这个点上迈出了大胆的一步：把交易数据直接发布到 Layer-1 上。因为数据是编码过的，体积不是太大的问题。这就转变了 Layer-2 的范式：要么交易数据有问题，要么交易数据没问题，那么依据一定状态转换规则得到的结果自然就没有争议。这就是 Rollup 方案的核心。

在此基础上，我们所听到的不同 Rollup 方案，其区别在于保证状态转换正确性（correctness）的方式不同，比如所谓的 ZK-Rollup，是使用密码学证明系统（主要是零知识证明技术）来做计算完整性（computational integrity）的证明，简言之，如果相关证据能通过验证，就证明计算一定按照相关流程执行了。而比如 Optimistic-Rollup，则是使用经济激励和挑战期的方案来保证上链数据的有效性：如果你觉得另一个运营者提出的 rollup 区块中含有无效交易，就存入押金发起挑战。

综上，Rollup 的概念为 Layer-2 的发展再添一把新柴，有望为以太坊网络解决可扩展性问题提供强大的助力。虽然一个新概念并不能解决所有问题，工程问题远比概念的推导更复杂（这是我们所有人都应具有的基本认识），比如，Rollup 方案也要面临用户取款的时候到账时延问题，因此需要流动性供应商。但 Rollup 方案确实是吸收了前人的教训，显现出不错的前景。

ZK-Rollup 已经有上线的案例，就是使用 Loopring zk-Rollup 方案的 Loopring.io 去中心化交易所；此外，Starkware 也在这个领域耕耘。Optimistic Rollup 的代表则有 Fuel，这是一个致力于稳定币支付的侧链项目。Rollup 概念的提出者 John Adler 也在这个项目里。

参考文献：

- [Optimistic Rollup vs. ZK Rollup：一探究竟](http://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652528693&idx=1&sn=533a24e6ed4113f0eb76a3e647ba664a&chksm=8ce66368bb91ea7e54f490ec6af3dbdc541c13e5d0ed0ee501b8917821e3e7d74090983b8820&scene=21#wechat_redirect)
- [Optimistic Rollup 为什么要这么设计？](http://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652529121&idx=1&sn=f0469b57959cb65252eb0e272f638ae9&chksm=8ce662bcbb91ebaacdc61e513cc3a1224c0bfe0c11d2bf57d775a5a426c9793d3290ff99c4e7&scene=21#wechat_redirect)

## DeFi

DeFi 应用正变得越来越复杂，在我看来这是一个好事。一开始（包括到现在也是）DeFi 的主要应用就是借贷，在这里我主要提的就是 Compound（MakerDAO 和 DAI 实际上要更复杂一些，不是借贷二字能简单概括的，虽然其形式也是借贷）。后来延伸到了保证金交易，即杠杆交易，先行者应属 dYdX。现在很多去中心化交易所都有保证金交易功能了，包括 DDEX。

现在已经出现了合成资产交易功能，即非实物结算的衍生品交易。比如在 Synthetix 平台上，可以合成比特币价格的衍生品。甚至现在还有一种有趣的操作，你可以拿自己的 ETH 中的一部分换成 DAI ，存入 Uniswap 成为流动性提供者，获得 Uniswap 的手续费收益，另一部分拿到保证金交易平台上两倍看多 ETH，这样就既不会错过 ETH 的涨价收益（当然也会面临 ETH 的跌价损失），又能得到一些手续费收益。DeFiZap 就提供这样的复合式操作，免去了用户自主操作的麻烦。

这些新出现的产品，有一些是独出心裁的，比如 Synthetix，在其系统中，所有合成资产的用户都是其他用户的对手方；另一些则一再印证了 “可组合性” 的存在，比如 DeFiZap。不论如何，它们都展现了 DeFi 的生命力，而且丝毫没有减弱的势头。

在 3 月 12 号的 ETH 价格大跌中，链上清算压力极大，也出些了一些不尽如人意的情形，有一些朋友觉得有些幻灭，但我丝毫不这么觉得。出现挫折是必然的，因为无论产品设计还是工程，永远没有完美无缺的东西。永远有一些东西是必须在现实中经受压力测试才能发现的。现在并没有暴露出哪个问题是不可解决的，反而，它暴露出来的是，DeFi 已经成长了很多 —— 原来根本没有那么多清算需求，而现在已经有了。

参考文献：

- [五款改变储蓄体验的以太坊 DeFi 应用](http://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652529225&idx=1&sn=c3a3fce48af1c6ca833e7a9f7bbf9cb1&chksm=8ce66114bb91e8021d3b805049233d1f0f70c4fa1cc23dcb099986b4abcff0b9d854cfe83f2d&scene=21#wechat_redirect)

## 改善使用体验的应用和技术

## 以太坊生态很早就开始关注区块链的用户体验问题了。所谓的用户体验，总结起来就是入门用户刚上手以太坊时候的都会问出的问题：什么是 Gas？丢了助记词，钱就找不回来了，这么坑的吗？

关于第一个问题，现在已经有了一种叫做 “元交易（meta-transaction）” 的技术：用户先对一个有效的交易数据签名并将其发送给一个中继者，由中继者确认数据的有效性后作为实际交易发送者发出交易，该交易会触发一系列的合约操作，完成用户的交易目的并为中继者支付。在这个过程中，Gas 的实际支付者是中继者，因此，只要用户和中继者达成一致意见，用户就可以不用 ETH 来支付，甚至可以不用付费（也就是中继者或者 dApp 自己补贴了用户）。

关于第二个问题，一种解决思路是，这个问题本质上是由以太坊协议带来的，协议层的账户体系不支持用户使用比助记词和私钥更复杂的方式来管理自己的地址和资金。但是，智能合约的表达可能性是没有这些限制的。因此，用户可以使用一个自己能控制的智能合约来管理资金，这个智能合约可以支持一些预先定义的方案来更替该智能合约的控制权，这样，就可以支持比如社交恢复方案了（让多个你信任的人用地址可以集体帮助你更换合约的控制权，这样就算你丢了手机或者私钥，还是可以恢复对该合约和资金的控制权，换个地址就行）。

此外，另一个大家早已熟知的用户体验改进方案是 ENS，可以帮助用户用可读的 .eth 地址来表示自己的地址。这样转账时就不用瞪大眼睛不断比较收账地址了，输入那个 .eth 地址就可以了（ENS 也有别的后缀）。

这些方法，最近都集中在一种应用上爆发了：智能合约型钱包。用户用智能合约来管理自己的资金，该智能合约可以有 ENS 地址，也往往直接集成了元交易功能，甚至支持社交恢复、每日转账限额这样的高级功能。现在智能合约钱包领域风头正劲的项目有两个：Argent 和 Authereum。

参考文献：

- [以太坊元交易](http://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652528509&idx=1&sn=e262120a36c5b20278305f1832fd2587&chksm=8ce65c20bb91d536b1389f2259d66040a2c7a3610610430a4fcb3869b87fd3fe22b974e105ac&scene=21#wechat_redirect)
- [Argent：为密码学资产安全性开创新时代](http://mp.weixin.qq.com/s?__biz=MzIwODA3NDI5MA==&mid=2652528513&idx=1&sn=a1154a05e8f94d586b8db66cbb84c195&chksm=8ce65cdcbb91d5ca4c05de55108ec7b1968010603e38095b6e2a0e2f1ac86bcad274e8f17c8f&scene=21#wechat_redirect)

## 以太坊2.0

