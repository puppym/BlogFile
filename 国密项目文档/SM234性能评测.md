## SM2/3/4性能评测

### 国密算法简介

国密算法一共分为SM1（SCB2），SM2，SM3，SM4，SM7，SM9，祖冲之密码算法（ZUC）

对称算法：SM1，SM4，SM7，祖冲之密码（ZUC）。

非对称算法：SM2，SM9。

哈希算法：SM3

其中SM1，SM7算法不公开，调用该算法通过加密芯片的接口进行调用。

### SM1

 SM1 算法是分组密码算法，分组长度为128位，密钥长度都为 128 比特，算法安全保密强度及相关软硬件实现性能与 AES 相当，算法不公开，仅以IP核的形式存在于芯片中。

 采用该算法已经研制了系列芯片、智能IC卡、智能密码钥匙、加密卡、加密机等安全产品，广泛应用于电子政务、电子商务及国民经济的各个应用领域（包括国家政务通、警务通等重要领域）。  

### SM2椭圆曲线公钥密码算法

 SM2算法就是ECC椭圆曲线密码机制，但在签名、密钥交换方面不同于ECDSA、ECDH等国际标准，而是采取了更为安全的机制。另外，SM2推荐了一条256位的曲线作为标准曲线。

由于该算法基于ECC，故其签名速度与秘钥生成速度都快于RSA。ECC 256位（SM2采用的就是ECC 256位的一种）安全强度比RSA 2048位高，但运算速度快于RSA。

 SM2标准包括总则，数字签名算法，密钥交换协议，公钥加密算法四个部分，并在每个部分的附录详细说明了实现的相关细节及示例。

### SM3

 SM3密码杂凑（哈希、散列）算法给出了杂凑函数算法的计算方法和计算步骤，并给出了运算示例。此算法适用于商用密码应用中的数字签名和验证，消息认证码的生成与验证以及随机数的生成，可满足多种密码应用的安全需求。在SM2，SM9标准中使用。

SM3 消息摘要。可以用MD5作为对比理解。该算法已公开。校验结果为256位。

此算法对输入长度小于2的64次方的比特消息，经过填充和迭代压缩，生成长度为256比特的杂凑值，其中使用了异或，模，模加，移位，与，或，非运算，由填充，迭代过程，消息扩展和压缩函数所构成。具体算法及运算示例见SM3标准。  

### SM4对称算法

 此算法是一个分组算法，用于无线局域网产品。该算法的分组长度为128比特，密钥长度为128比特。加密算法与密钥扩展算法都采用32轮非线性迭代结构。解密算法与加密算法的结构相同，只是轮密钥的使用顺序相反，解密轮密钥是加密轮密钥的逆序。

此算法采用非线性迭代结构，每次迭代由一个轮函数给出，其中轮函数由一个非线性变换和线性变换复合而成，非线性变换由S盒所给出。其中rki为轮密钥，合成置换T组成轮函数。轮密钥的产生与上图流程类似，由加密密钥作为输入生成，轮函数中的线性变换不同，还有些参数的区别。SM4算法的具体描述和示例见SM4标准。 

由于SM1、SM4加解密的分组大小为128bit，故对消息进行加解密时，若消息长度过长，需要进行分组，要消息长度不足，则要进行填充。 

### SM7对称密码

SM7算法，是一种分组密码算法，分组长度为128比特，密钥长度为128比特。SM7适用于非接触式IC卡，应用包括身份识别类应用(门禁卡、工作证、参赛证)，票务类应用(大型赛事门票、展会门票)，支付与通卡类应用（积分消费卡、校园一卡通、企业一卡通等）。

### SM9标识密码算法

 为了降低公开密钥系统中密钥和证书管理的复杂性，以色列科学家、RSA算法发明人之一Adi Shamir在1984年提出了标识密码（Identity-Based Cryptography）的理念。标识密码将用户的标识（如邮件地址、手机号码、QQ号码等）作为公钥，省略了交换数字证书和公钥过程，使得安全系统变得易于部署和管理，非常适合端对端离线安全通讯、云端数据加密、基于属性加密、基于策略加密的各种场合。2008年标识密码算法正式获得国家密码管理局颁发的商密算法型号：SM9(商密九号算法)，为我国标识密码技术的应用奠定了坚实的基础。

SM9算法不需要申请数字证书，适用于互联网应用的各种新兴应用的安全保障。如基于云技术的密码服务、电子邮件安全、智能终端保护、物联网安全、云存储安全等等。这些安全应用可采用手机号码或邮件地址作为公钥，实现数据加密、身份认证、通话加密、通道加密等安全应用，并具有使用方便，易于部署的特点，从而开启了普及密码算法的大门。  

### ZUC祖冲之算法

 祖冲之序列密码算法是中国自主研究的流密码算法,是运用于移动通信4G网络中的国际标准密码算法,该算法包括祖冲之算法(ZUC)、加密算法(128-EEA3)和完整性算法(128-EIA3)三个部分。目前已有对ZUC算法的优化实现，有专门针对128-EEA3和128-EIA3的硬件实现与优化。

## 性能测试

本文主要选取以下三个库对比我们库的SM4的性能。

go接口 10000

297.8268ms
313.4037ms

c 接口102400次

16字节执行1024次加解密时间为t。(1s/t)*16/1024

| SM4  | secbit_sm | SMx               | gmsm                      | libsm |
| ---- | --------- | ----------------- | ------------------------- | ----- |
| 加密 | 2.704916s | 8.20M/s 1.640475s | 7.50M/s        471.2519ms |       |
| 解密 | 2.787936s | 1.663272s         | 9.89M/s 455.2257ms        |       |
|      |           |                   |                           |       |



356字节的数据循环102400次

| SM4  | secbit_sm_c(357位字符) | secbit_sm_go | SMx(357位字符) | gmsm       | libsm |
| ---- | ---------------------- | ------------ | -------------- | ---------- | ----- |
| 加密 | 5.075788s              | 3.049746s    | 1.64047s       | 471.2519ms |       |
| 解密 | 5.332717s              | 3.2092467s   | 1.663272s      | 455.2257ms |       |
| 加密 | 6.8 M/s                | 11.43M/s     | 21.25M/s       | 73.98M/s   |       |
| 解密 | 6.5 M/s                | 10.86M/s     | 21.00M/s       | 76.19M/s   |       |



704字节的数据循环1000次

`1234567890123456789012345678901234567890123456789012345678901234cafebabecafebabecafebabecafebabecafebabecafebabecafebabecafebabe1234567890123456789012345678901234567890123456789012345678901234cafebabecafebabecafebabecafebabecafebabecafebabecafebabecafebabe1234567890123456789012345678901234567890123456789012345678901234cafebabecafebabecafebabecafebabe1234567890123456789012345678901234567890123456789012345678901234cafebabecafebabecafebabecafebabecafebabecafebabecafebabecafebabe1234567890123456789012345678901234567890123456789012345678901234cafebabecafebabecafebabecafebabecafebabecafebabecafebabecafebabe1234567890123456789012345678901234567890123456789012345678901234cafebabecafebabecafebabecafebabe`

| SM2      | secbit_sm_c | SMx       | gmsm       | libsm |
| -------- | ----------- | --------- | ---------- | ----- |
| 密钥生成 | 2.242358s   | 0.275906s | 285.686ms  |       |
| 签名     | 2.483654s   | 0.548849s | 305.3625ms |       |
| 验证     | 4.547222s   | 0.690225s | 1.6402006s |       |
| 加密     | 4.509986s   | 1.333169s | 1.6779454s |       |
| 解密     | 2.331464s   | 0.813219s | 1.3866571s |       |



3146字节的数据循环1000次

| SM3      | secbit_sm_c        | SMx       | gmsm        | libsm |
| -------- | ------------------ | --------- | ----------- | ----- |
| hmac哈希 | 0.079121s  18.9M/s | 0.002335s | 0.00290315s |       |



国密算法实现的第三方库：

1. https://github.com/NEWPLAN/SMx （c 的实现）
2. https://github.com/tjfoc/gmsm （同济研究院的go 实现版本）
3. https://github.com/citahub/libsm （cita 实现的 rust 版本）
sm9 实现可以参考：
1. https://github.com/songgeng87/SM9_FREE/tree/master/SM9_FREE/sm9
国密算法文档：
http://www.gmbz.org.cn/main/bzlb.html