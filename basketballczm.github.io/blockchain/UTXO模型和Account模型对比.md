# 账户状态存储模型
## 比特币和Hyperledger是UTXO
交易输出是比特币不可分割的基本集合，记录在区块上。所有UTXO(unspent transaction outputs "未花费的交易输出")的集合被称为UTXO集，目前又有数百万个UTXO。当新的UTXO被创建，UTXO集就会变大，当UTXO被消耗时，UTXO集就会随着减小。每一个交易都代表UTXO集的变化(状态转换)。

### 好处
1. 可扩展性。由于可以同时处理多个UTXO，因此可以实现并行事务并鼓励可伸缩性创新。
2. 隐私。甚至比特币也不是一个完全匿名的系统，但只要用户为每笔交易使用新地址，UTXO就可以提供更高级别的隐私。
![图片](<images/1.jpg>)

### 缺点
不支持图灵完备，该模型在状态保存以及和编程性方面存在缺陷。无法实现一些比较复杂的逻辑，可编程性差。对于复杂逻辑，或者需要状态保存的合约，实现难度大，且状态空间利用率比较低。当 Input 较多时，见证脚本也会增多。而签名本身是比较消耗 CPU 和存储空间的。

## 以太坊和EOS是Account模型。
对于Account模型，Account模型保存了世界状态，链的状态一般在区块中以StateRoot和ReceiptRoot等形式进行共识。交易只是时间本身，不包含结果，交易的共识和状态的共识本质上可以隔离的。
Account的原理就像账户状态记录保存在银行一样。类比是使用ATM借记卡。银行跟踪每张借记卡有多少钱，当我们需要花钱时，银行会在批准交易前检查记录以确保我们有足够的余额。

### 好处
1. 简单性。以太坊选择了一种更直观的模式，以便为复杂智能合约的开发人员带来益处，尤其是那些需要国家信息或涉及多方的开发人员。 一个例子是一个智能合约，跟踪各国根据它们执行不同的任务。 UTXO的无状态模型会迫使交易包含状态信息，这不必要地使合约的设计复杂化。
2. 效率。除了简单之外，账户/余额模型更加高效，因为每笔交易只需要验证发送账户是否有足够的余额来支付交易。
3. 图灵完备。

### 缺点
账户/余额模型的一个缺点是暴露于双重支出攻击。 可以实施递增的随机数来抵消这种类型的攻击。 在以太坊中，每个帐户都有一个公共可见的随机数，每次进行交易时，随机数都会增加一个。 这可以防止相同的事务被多次提交。 （注意，这个随机数不同于以太坊的以太坊证明，这是一个随机值。）但是这样也引入了交易的顺序性问题，使得交易无法并行。

![图片](<images/2.jpg>)


# 粉尘攻击
对于长期不消费的UTXO会一直占用节点的内存，所以对于这种模型而言，理论上应该鼓励用户减少生产UTXO，多消耗UTXO。但是如果要使用UTXO进行并行交易则需要更多的UTXO作为输入，同时产生更多的UTXO来保证并发性，这本质上是对网络进行了粉尘攻击(通过恶意的手段产生很多的UTXO来占用节点的内存)。

# 两者的存储问题
因为UTXO模型中，只能在交易中保存状态。而Account模型的状态是在节点保存，在Ethereum中使用MPT的方式存储，Block中只需要共识StateRoot（验证同步状态数据的完整性和正确性）等即可。这样对于链上数据，Account模型实际更小，网络传输的量更小，同时状态在节点本地使用MPT方式保存，在空间使用上也更有效率。例如 A 向 B 转账，如果在 UTXO 中假设存在 2 个 Input 和2个 Output，则需要 2 个 Witness script 和 2 个Locking script；在Account模型中则只需要一个签名，交易内容只包含金额即可。在最新的隔离见证实现后，Bitcoin的交易数据量也大大减少，但是实际上对于验证节点和全节点仍然需要针对 Witness script 进行传输和验证。

## 以太坊的MPT存储
以太坊中的世界状态是通过MPT树实现的。MPT树是在内存中的连接关系，为了持久化存储，MPT树的连接关系可以转化为一系列的K-V对，以太坊将这些K-V对存储在levelDB中。

# 参考链接
* http://8btc.com/thread-219728-1-1.html
* https://blog.csdn.net/omnispace/article/details/80262019