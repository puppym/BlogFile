1. ARP协议问题。 
ARP协议的作用是什么。 
ARP地址解析协议，通过主机A通过广播主机B的IP地址，所有局域网内的主机都能收到该广播包，只有主机B回复该包并且带上自身的MAC地址。A收到B的回复后将B主机的IP地址和MAC地址的映射添加到自身的ARP缓存中。 

引入ARP缓存的功能是什么。 
提高ARP地址解析速度，当某台主机短时间内多次进行ARP查询时，如果该主机ARP缓冲区内已经存在查询主机IP地址到MAC地址的映射，可以直接通过IP地址获取MAC地址，避免广播ARP请求包。 

ARP缓存中毒的攻击方法和效果是什么。
通过使用netwox 80 发送ARP数据包，当某一主机发现该APR数据包中的内容在本机的ARP缓冲中不存在或者已经更新时，该主机就会接收该数据包，并且更新本机的ARP缓存。

2. IP协议安全问题
为什么IP要进行分片？
主要使因为硬件环境的MTU(最大传输单元)的限制，一个IP报文最多可以达到65535的最大长度，但是网络硬件限制了帧的大小(以太网限制为1500字节)。

IP分片如何进行重组？
IP分片的重组主要和3个字段有关：
IDENT字段也即identifier，用于标识IP报文段的唯一标识符，具有同一IDENT的片段属于同一个IP报文。 
FRAGMENT OFFSET:简称FO，指明当前片段在原始完整的IP报文中的位置。该偏移为8个字节。 
FLAGS： bit 0：保留  bit 1：不分片  bit:2 更多分片 若bit2中的位为1，则说明不是最后一个分片，如果bit2中的位为0，则是最后一个分片。
根据这3个字段进行重组，并且在IP层之上必须进行重组，将完整的数据包发到上层。 

泪滴攻击（teardrop）的原理是什么？ 
TearDrop攻击的原理，在于构造两个分片。其中，第二个分片完全包含在第一个分片中。也即，第二个分片的FO大于第一个分片的FO，但是第二个分片的FO+ Len，都小于第一个分片最后一个字节的位置，也即第一个分片的FO+len。 1. 首先计算重叠部分长度pre->end-offset。2. 计算第二个部分非重叠部分的起始位置offset = offset + (pre->end-offset)。3. 未重叠的部分 = end-offset，如果这里是泪滴攻击的情况这里会发生溢出，从而未重叠的部分将变成一个非常大的数。

包过滤防火墙，通过过滤SYN包，防止外部链接。攻击者可以如何绕过这个过滤？ 
可以使用微小碎片攻击来绕过这个过滤，通过许多IP实现，可以在传出数据包上形成异常小的片段大小。如果片段大小足够小以迫使某些TCP数据包的TCP头字段进入第二个片段，则指定这些字段的模式的过滤规则将不匹配。如果过滤实现没有强制执行最小片段大小，则可能会通过不允许的数据包，因为它在过滤器中没有得到匹配。
**防御** 
如果FO = 0且PROTOCOL = TCP，TRANSPORTLEN < tmin 
DROP PACKET


3. ICMP协议安全。
什么是SMURF攻击？如何防止？
Smurf攻击是一种分布式拒绝服务攻击，其中使用IP广播地址将具有预期受害者的欺骗源IP的大量互联网控制消息协议（ICMP）分组广播到计算机网络。 默认情况下，网络上的大多数设备都会通过向源IP地址发送回复来对此做出响应。 如果网络上接收和响应这些数据包的机器数量非常大，受害者的计算机将忙于处理ping回复包。 这可能会使受害者的计算机变慢，无法继续工作。 
**防御方式**配置各个主机和路由器不响应ICMP请求或广播，配置路由器不转发定向到广播地址的数据包。

什么是ICMP重定向攻击？如何防止？
攻击者通过ICMP重定向报文更改受害者的路由表缓冲区来改变某天路由的下一条地址，从而达到路由表不能正常转发的目的。 
**防御方式**防火墙设置，禁止主机接收ICMP重定向包和路由器发送ICMP重定向包。2. 对主机设置静态路由。 


4. TCP协议安全。
什么是SYN flooding攻击？效果是什么？如何防止？
SYN flooding之前也讨论过，发生这种攻击的原因是因为TCP三次握手过程中的一个设计。当应用开放了一个TCP端口后，该端口就处于侦听状态，不停地监视发到该端口的Syn报文，一旦接收到Syn报文，就需要为即将建立的TCP连接分配TCB（Transmission Control Block），通常一个TCB至少需要280个字节，在某些操作系统中TCB甚至达到1300个字节；并且进入半开连接（half-opening）状态，也即收到SYN包而还未收到ACK包时的连接状态。操作系统实现的最多可开启的半开连接个数是一定的，譬如512，而受到内存的限制，可能还达不到这个数字。如果半开连接的个数过多，就会消耗掉可用的内存，使得新的正常的连接请求不能被处理。
新的主机不能连接服务器，服务器拒绝提供服务。 
使用 SYN cookie。SYN Cookie的原理即针对在ACK还未到达之前就需要分配大量资源的问题而提出的解决方案。
SYN Cookie的工作过程如下：在接收到客户端的TCP SYN数据包时，服务器构造TCP SYN + ACK数据包发送回客户端。根据TCP规范，端点发送的第一个序列号可以是由该端点决定的任何值。在该数据包中的序列号的值不再是随机值，或者是其他方法生成的值，而是，SYN cookie根据以下规则精心构建的初始序列号：序列号是32位，是由时间戳，SYN队列中的最大值，服务器IP，端口，客户端IP和端口取hash得到。


端口扫描的原理是什么？ 
通过nmap工具向目标主机端口发送带有特定字段的数据包，通过判断主机的回应，来判断主机各个端口的状态。

namp -sS和nmap -sT的区别是什么？
-sT 不用sudo权限，每次探测过程建立了一次tcp连接，被服务器记录  -sS 违反了协议栈要使用sudo权限，每次探测没有建立tcp连接，隐蔽性更高。

nmap -sA扫描的原理是什么？
-sA扫描是通过设置ACK位进行扫描的方法。ACK数据包不会启动会话建立，所以比较隐蔽；同时，因为ACK数据包不会单独出现，所以，对于端口，不管是开放的还是关闭的，如果收到一个不请自来的ACK数据包，都会发一个RST包。那这样的话，ACK扫描就不可能识别端口的开放和关闭情况。那么它有什么用呢？它可以识别端口有没有被过滤。


nmap idle扫描的原理是什么？
Idle Scan的特点是允许进行完全盲目的端口扫描。事实上，攻击者可以不用向目标发送数据包就完成扫描工作，因此，这是一种隐蔽性非常好的扫描方法。
这种扫描方式，除了隐蔽性之外，还有一些原因。它的一个优势是有可能绕过防火墙。考虑到公司内部管理严密，但是对高管开放访问，在公司外部，只有来自高管的IP可以进入。这样，如果高管自己的主机能够充当zombie主机，攻击者就可以完成对内部主机的扫描。 
每一个IP包都有identifier字段，用于标识属于同一数据包的所有IP碎片（下文称为IP ID）。
每发一个IP数据包，很多操作系统对identifier字段简单地增加1。
因此，针对identifier字段进行检测，可以判断主机距离上一次发包之后又发了几个数据包。

探测Zombie的IP ID并记录下来。
伪造Zombie主机发数据包给目标主机。根据端口的状态，目标主机可能会也有可能不会导致Zombie主机IP ID值增加。
再探测Zombie主机的IP ID。比较两次得到IP ID值。

RST数据是不会导致IDENT字段增加，因此无法区分关闭和被过滤的情况。 



5. 防火墙。
iptables是状态防火墙。状态防火墙相比于包过滤防火墙的优点是什么？
从会话来看，通信过程中的会话数据包不是一个个完全独立的数据包，而是有前后连接状态的。譬如建立可靠的TCP三次握手连接，是按照SYN、SYN+ACK以及ACK的顺序来的，如果没有发送SYN报文，就收到对方的ACK报文，这个ACK报文就是一个应该丢弃的数据包。
状态检测防火墙在接收到连接建立请求是，就可以建立一张表，在表中存储相关的各个连接的信息，建立连接状态规则，基于这个表对进入和出去的数据包进行匹配。当然，状态防火墙同样可以实现包过滤防火墙的各种功能，进行网络层和传输层的各种检查。
因此，可以理解动态，在同一个会话中，五元组(源地址、目标地址、协议、源端口、目标端口dport)不会变化，但是各种状态标识、分片等都是可以变化的。通过结合状态进行过滤，可以实现比较好的效果。

NAT的作用是什么？
网络地址转换，使得同一个子网内的主机公用一个公网IP，子网内部每台主机拥有内网IP。一般用于共享上网或者特殊端口的转换服务。 
譬如由于IPv4地址匮乏，一个机构中有十台主机需要上网，但是这个机构只分配到了一个公网IP。在局域网内部，这十台主机可以使用私有地址进行通信；但是为了获得公网中的服务，必须使用公网IP。NAT就可以用于解决这个问题。内网主机向外发出数据包时，NAT服务负责将数据包的源IP地址改成公网IP地址（SNAT）；当外网对内网主机的回复到达时，NAT服务将回复包的目的IP再改成内网IP地址（DNAT）。现在，无线网络中也使用这种技术。

sudo iptables –P INPUT DROP； iptables -A INPUT -p tcp --sport 80 -j ACCEPT 这两条语句的作用是什么？
对所有输入的数据包进行丢弃，但是接受http服务的请求数据包。

6. Rootkit。
什么是rootkit？
一种黑客安全工具，用于捕获进出计算机的密码和消息流量。一组工具，允许黑客为系统提供后门，收集网络上其他系统的信息，掩盖系统被破坏的事实，等等。rootkit是特洛伊木马软件的经典例子。rootkit可用于各种操作系统。 总结：1. 捕获计算机密码和消息流量。2. 允许为黑客提供后门。3. 收集网络上的一些其他系统信息。4. 掩盖系统被破坏的事实。

LKM的好处是什么？
攻击Linux的最高技术之一就是使用内核代码。这种内核代码可据其特性称为可加载内核模块（Loadable Kernel Module，LKM），是一段运行在内核空间的代码，可以访问操作系统最核心的部分。LKM是Linux内核为了扩展其功能所使用的可加载内核模块。LKM的优点是动态加载，在不重编译内核和重启系统的条件下对类Unix系统的系统内核进行修改和扩展。

请描述系统调用劫持的过程。
首先找IDT中断向量表的表头，由于中断使用比较频繁，一般会存在一个寄存器中，通过中断号和中断向量表找到系统调用中断处理程序的函数地址(这个函数会做一些环境保存和恢复的工作，以及通过系统函数表和eax来查找要调用系统函数的地址)，通过查找系统调用函数的call指令，call的函数地址可以找到sys_call_table的地址，根据系统调用表可以找到所要调用的系统函数，，取消SCT表的写保护，可以修改该处系统调用表的系统调用，并且进行调用。

请解释，为何Unix可以做到一切皆文件。
VFS虚拟文件系统。不仅普通的文件，目录、字符设备、块设备、 套接字等在 Unix/Linux 中都是以文件被对待；它们虽然类型不同，但是对其提供的却是同一套操作界面。

虚拟文件系统（Virtual File System, 简称 VFS）， 是 Linux 内核中的一个软件层，用于给用户空间的程序提供文件系统接口；同时，它也提供了内核中的一个 抽象功能，允许不同的文件系统共存。系统中所有的文件系统不但依赖 VFS 共存，而且也依靠 VFS 协同工作。

向上，对应用层提供一个标准的文件操作接口；
对下，对文件系统提供一个标准的接口，以便其他操作系统的文件系统可以方便的移植到Linux上；
VFS内部则通过一系列高效的管理机制，比如inode cache, dentry cache 以及文件系统的预读等技术，使得底层文件系统不需沉溺到复杂的内核操作，即可获得高性能；
此外VFS把一些复杂的操作尽量抽象到VFS内部，使得底层文件系统实现更简单。

7. 缓冲区溢出。
什么是返回地址？
IP 

汇编语言中，call指令的作用是什么？
push IP  jump 函数地址 

请描述当函数调用发生时，进程地址空间中栈帧的变化。
32位

64位

如何防止缓冲区溢出攻击。
1. 堆栈起始地址随机化
2. 编译器数组越界保护
3. 防止堆栈运行。

## 填空 
IPTABLES 中的四张表分别是filter表，nat表，mangle表，raw表

filter主要和主机自身有关，主要负责防火墙功能 过滤本机流入流出的数据包是默认使用的表;

input :负责过滤所有目标地址是本机地址的数据包，就是过滤进入主机的数据包;
forward :负责转发流经主机但不进入本机的数据包，和NAT关系很大;
output :负责处理源地址的数据包，就是对本机发出的数据包;

NAT表负责网络地址转换，即来源于目的IP地址和端口的转换，一般用于共享上网或特殊端口的转换服务

snat :地址转换
dnat :标地址转换
pnat :标端口转换
mangle表负责拆解报文，修改并重新封装。

raw表可以关闭iptables中开启的连接追踪。

chmod 777 some binary //将该二进制文件的权限改成所有人可读可写可执行。拥有者，同组人，所有人
可读 4  可写 2  可执行 1

nc -l localhost 1234 //监听本地的1234端口 
nc localhost 2345  //连接本地的2345端口

telnet不安全的原因：
telnet使用明文传送数据，容易被监听分析出账号口令什么的，ssh基于安全层加密传输，数据经过加密才传送，不容易被破解
1. 明文传输 2. 没有完整性检查，传送的数据没办法知道是否完整，而不是被篡改过的数据。 3. 没有强力认证，验证连接者仅仅通过账户和密码。 
没有口令保护，远程用户的登陆传送的帐号和密码都是明文，使用普通的sniffer都可以被截获
没有强力认证过程。只是验证连接者的帐户和密码。
没有完整性检查。传送的数据没有办法知道是否完整的，而不是被篡改过的数据。
传送的数据都没有加密。

https://zhuanlan.zhihu.com/p/24698829
