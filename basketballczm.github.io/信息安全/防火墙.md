# 防火墙分类 
防火墙分为3类：1. 包过滤防火墙。2. 应用层网关代理防火墙。3. 状态防火墙

## 包过滤  --tcp-flags
**包过滤防火墙**也可以成为无状态防火墙，静态防火墙。包过滤是通过ACL（Access Control List）规则控制数据流的。IP数据包中最明显最核心的五元素就是，源地址、目标地址、协议、源端口、目标端口dport。包过滤主要也就是根据这些包头部的元素进行判断。之所以叫做静态防火墙，是因为在一次会话中，这五个元素是不会变化的。 
**缺点**1. 难以处理分片(IP碎片攻击)。2. 不支持某些复杂的协议。3. 不能防止应用层等恶意攻击 
**攻击方式**通过伪造核心的5个元素，比如通过80端口(http数据返回端口)返回ftp服务的SYN标志位来建立连接。
**防御方式** 从简单到复杂，数据返回1.只检查源端口为80。2.检查源端口为80，目的端口为>1023,通过。3.目的端口为80，目的端口大于1023，只接受ACK包。但是即使不能够建立连接，一些嗅探的包也能通过，比如使用nmap -sA 进行扫描。

## 网关代理防火墙 
**网关代理防火墙**对于客户端来说，代理充当了服务器的角色，对于真正的服务器来说，充当了客户端的角色。所以通过使用代理主机，客户和服务器之间从不会有真正的连接。应用代理网关防火墙彻底隔断内网与外网的直接通信，内网用户对外网的访问变成防火墙对外网的访问，服务器返回的数据首先到达防火墙，经过安全策略检测，然后再由防火墙转发给内网用户。也即所有通信都必须经应用层代理软件转发。 
这种方式的优点显而易见，对数据的控制直接上升到应用层，对数据包检测非常充分。缺点，同时为了实现这一点，对于每一个服务应用，写要编写特定的安全代理程序，也即相应的客户端与服务器端程序。因此，很多应用用得不到支持 

## 状态监测防火墙  --state
**状态监测防火墙**动态包过滤防火墙通信过程中的会话数据包不是一个个完全独立的数据包，而是有前后连接状态的。譬如建立可靠的TCP三次握手连接，是按照SYN、SYN+ACK以及ACK的顺序来的，如果没有发送SYN报文，就收到对方的ACK报文，这个ACK报文就是一个应该丢弃的数据包。 
状态检测防火墙在接收到连接建立请求是，就可以建立一张表，在表中存储相关的各个连接的信息，建立连接状态规则，基于这个表对进入和出去的数据包进行匹配。当然，状态防火墙同样可以实现包过滤防火墙的各种功能，进行网络层和传输层的各种检查。 
因此，可以理解动态，在同一个会话中，五元组不会变化，但是各种状态标识、分片等都是可以变化的。通过结合状态进行过滤，可以实现比较好的效果。

## iptables 命令 
* sudo iptables -L 
* sudo iptables -P INPUT DROP 不允许进入 
* sudo iptables -A INPUT -p icmp -j ACCEPT  允许ping包进入 
* sudo iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT 只接受icmp echo reply 
* sudo iptables -A INPUT -p INPUT -p tcp --sport 23 -j ACCEPT 接受telnet连接 
* iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 5/min -j ACCEPT limit功能限制每分钟接收数据包的个数 
* sudo iptables -I OUTPUT -m string --algo bm --string "baidu" -j REJECT 严禁请求字符串中出现“baidu”的字符串 
* iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT 拒绝入站新的连接请求与无效连接，仅仅放行入站的回应请求。





FTP客户端连接到FTP服务器的21端口，登录成功后要list列表或者读取数据时，发送PASV命令到FTP服务器， 服务器在本地随机开放一个端口（1024以上），然后把开放的端口告诉客户端， 客户端再连接到服务器开放的端口进行数据传输。PORT（主动）模式模式只要开启服务器的21和20端口，而PASV（被动）模式需要开启服务器大于1024所有tcp端口和21端口。从网络安全的角度来看的话似乎ftp PORT模式更安全，而ftp PASV更不安全，那么为什么RFC要在ftp PORT基础再制定一个ftp PASV模式呢？其实RFC制定ftp PASV模式的主要目的是为了数据传输安全角度出发的，因为ftpport使用固定20端口进行传输数据，那么作为黑客很容使用sniffer等探嗅器抓取ftp数据。 

加载内核模块（Loadable Kernel Module，LKM） netfilter